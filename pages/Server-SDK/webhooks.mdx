---
title: "Webhooks"
---

import { Callout } from "nextra-theme-docs";

## Web Hooks

{" "}

<Callout>
  Reachout to the Huddle01 Team to set your webhook URL for your subdomain,
  you'll be able to set it up from the dashboard soon.
</Callout>

### Usage:

```ts
import { WebhookReceiver } from "@huddle01/server-sdk/webhooks";

// Initiate webhook receiver
const webhookReceiver = new WebhookReceiver({
  apiKey: "YOUR_API_KEY",
});

// validate body using the receive func
const receivedData = receiver.receive(req.body, header); 

// get properly typed data in typescript
const { data } = webhookReceiver.createTypedWebhookData(
  "meeting:started",
  receivedData.payload,
);
```

<details>
  <summary>
    Express Example to listen to webhooks events
  </summary>
    <Callout>
    To make the webhook work on localhost, you'll have to use something like `ngrok` for port forwarding.
    </Callout>
    <Callout>
    The `Content-Type` is set to "Content-Type": "text/plain", attempting to parse it as JSON, multipart, or any other structured format will not work as expected. Please ensure that you handle the content as plain text.
    </Callout>

    ```ts
    import express, { Request, Response } from "express";
    import bodyParser from "body-parser";
    import { WebhookReceiver } from "@huddle01/server-sdk/webhooks";

    const receiver = new WebhookReceiver({
      apiKey: "YOUR_API_KEY",
    });

    const app = express();
    const port = 3002;

    // Middleware to parse the body as text/plain
    app.use(express.text({ type: '*/*' }));

    app.post("/", (req: Request, res: Response) => {
      try {
        const header = req.headers["huddle01-signature"] as string | undefined;

        const data = receiver.receive(req.body, header);

        console.log({ data });

        switch (receivedData.event) {
          case "meeting:started": {
            // !! Thie helper will give properly typed data in typescript
            const { data } = webhookReceiver.createTypedWebhookData(
              "meeting:started",
              receivedData.payload,
            );

            // ... logic as per requirment
            break;
          }

          case "meeting:ended": {
            const { data } = webhookReceiver.createTypedWebhookData(
              "meeting:ended",
              receivedData.payload,
            );

            // ... logic as per requirment
          }

          // ... cases for peer:joined, peer:left, recording:started, etc
        }

        res.status(200).send({ success: true });
      } catch (error) {
        console.error({ error });
      }
    });

    app.listen(port, () => {
      console.log(`ðŸ¦Š Express server running at http://localhost:${port}`);
    });

    ```

</details>

### Events

You can listen to these event on your server side and perform various actions based on the events. Following is the list of events you can listen to:

<details>
    <summary>
    **`meeting:started`**
    </summary>

```ts
type MeetingStarted = {
  sessionId: string;
  roomId: string;
  createdAt: number;
};
```

</details>

<details>
    <summary>
    **`meeting:ended`**
    </summary>

```ts
type MeetingEnded = {
  sessionId: string;
  roomId: string;
  createdAt: number;
  endedAt: number;
  duration: number;
  participants: number;
  maxParticipants: number;
  audioMinutes: number;
  videoMinutes: number;
};
```

</details>

<details>
    <summary>
    **`peer:joined`**
    </summary>

```ts
type PeerJoined = {
  id: string;
  sessionId: string;
  roomId: string;
  joinedAt: number;
  metadata?: string;
  role?: string;
  browser: {
    name?: string;
    version?: string;
  };
  geoData?: {
    region: string;
    country: string;
  };
  device: {
    model?: string;
    type?: string;
    vendor?: string;
  };
};
```

</details>

<details>
    <summary>
    **`peer:left`**
    </summary>

```ts
type PeerLeft = {
  id: string;
  sessionId: string;
  roomId: string;
  leftAt: number;
  duration: number;
  metadata?: string;
  role?: string;
}
```

</details>

<details>
    <summary>
    **`recording:started`**
    </summary>

```ts
type Recording = {
  id: string;
  roomId: string;
  sessionId: string;
  files: {
    duration: number;
    size: number;
    filename: string;
    location: string;
  }[];  // This array will be empty when we start the recording
  streams: {
    duration: number;
    url: string;
    startedAt: number;
    endedAt: number;
  }[];  // This array will be empty when we start the recording
  cid?: string;
  ipfsUrl?: string;
};
```

</details>

<details>
    <summary>
    **`recording:stopped`**
    </summary>

```ts
type Recording = {
  id: string;
  roomId: string;
  sessionId: string;
  files: {
    duration: number;  // Duration is in seconds
    size: number;  // Size is in MB
    filename: string;
    location: string;
  }[];
  streams: {
    duration: number;  // Duration is in seconds
    url: string;
    startedAt: number;
    endedAt: number;
  }[];
  cid?: string;
  ipfsUrl?: string;
};
```

</details>

<details>
    <summary>
    **`recording:updated`**
    </summary>

```ts
type Recording = {
  id: string;
  roomId: string;
  sessionId: string;
  files: {
    duration: number;  // Duration is in seconds
    size: number;  // Size is in MB
    filename: string;
    location: string;
  }[];
  streams: {
    duration: number;  // Duration is in seconds
    url: string;  // rtmp url, where you streamed to
    startedAt: number;
    endedAt: number;
  }[];
  cid?: string;
  ipfsUrl?: string;
};
```

</details>